#!/bin/bash
#
# Git Flow Enforcement - Commit Message Hook
# Validates commit message format and content
#

COMMIT_MSG_FILE=$1
COMMIT_MSG=$(cat "$COMMIT_MSG_FILE")

# Ignore merge commits and git flow automated messages
if echo "$COMMIT_MSG" | grep -qE "^Merge (branch|remote-tracking branch)"; then
    exit 0
fi

# Check minimum length (excluding empty lines and comments)
MSG_LENGTH=$(echo "$COMMIT_MSG" | grep -v '^#' | grep -v '^$' | wc -c | tr -d ' ')

if [ "$MSG_LENGTH" -lt 10 ]; then
    echo ""
    echo "❌ COMMIT REJECTED - Invalid Commit Message"
    echo ""
    echo "Commit message is too short (minimum 10 characters)."
    echo ""
    echo "Please provide a meaningful commit message describing your changes."
    echo ""
    exit 1
fi

# Check for common bad patterns
if echo "$COMMIT_MSG" | grep -qiE "^(wip|test|temp|tmp|fix|update)$"; then
    echo ""
    echo "⚠️  WARNING - Generic Commit Message"
    echo ""
    echo "Commit message '$COMMIT_MSG' is too generic."
    echo ""
    echo "Please provide more context about what was changed and why."
    echo ""
    # Don't exit - just warn
fi

exit 0
